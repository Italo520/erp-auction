(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[313],{191:(e,t,s)=>{Promise.resolve().then(s.bind(s,9934))},2404:(e,t,s)=>{"use strict";s.d(t,{c:()=>o,O:()=>d});var a=s(5155),r=s(2115);class n{async execute(e,t){if(!e)throw Error("Email \xe9 obrigat\xf3rio");return this.authRepo.signIn(e,t)}constructor(e){this.authRepo=e}}class l{async execute(){return this.authRepo.signOut()}constructor(e){this.authRepo=e}}class i{async execute(){return this.authRepo.getCurrentUser()}constructor(e){this.authRepo=e}}var c=s(334);let o=(0,r.createContext)({}),d=e=>{let{children:t}=e,{authRepo:s}=(0,c.u)(),[d,u]=(0,r.useState)(null),[m,h]=(0,r.useState)(!0),x=(0,r.useMemo)(()=>new n(s),[s]),b=(0,r.useMemo)(()=>new l(s),[s]),p=(0,r.useMemo)(()=>new i(s),[s]);(0,r.useEffect)(()=>{let e=!0;return(async()=>{try{let t=await p.execute();e&&u(t)}catch(e){console.error("Failed to load user",e)}finally{e&&h(!1)}})(),()=>{e=!1}},[p]);let f=async(e,t)=>{h(!0);try{await x.execute(e,t);let s=await p.execute();u(s)}finally{h(!1)}},g=async()=>{h(!0);try{await b.execute(),u(null)}finally{h(!1)}};return(0,a.jsx)(o.Provider,{value:{user:d,isAuthenticated:!!d,isLoading:m,login:f,logout:g},children:t})}},7601:(e,t,s)=>{"use strict";s.d(t,{A:()=>n});var a=s(2115),r=s(2404);let n=()=>{let e=(0,a.useContext)(r.c);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}},9934:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>C});var a=s(5155),r=s(2115),n=s(1142),l=s(334),i=s(7601),c=s(8720),o=s(1136);class d{subscribeToAuctionBids(e,t){let s="auction-bids-".concat(e);if(this.channels.has(s))return this.channels.get(s);let a=o.N.channel(s).on("postgres_changes",{event:"INSERT",schema:"public",table:"bids",filter:"auction_id=eq.".concat(e)},e=>{console.log("Novo lance recebido:",e.new),t({id:e.new.id,auctionId:e.new.auction_id,vehicleId:e.new.vehicle_id,userId:e.new.user_id,amount:e.new.amount,timestamp:new Date(e.new.created_at||e.new.timestamp),channel:e.new.channel||"WEB",isCancelled:e.new.is_cancelled||!1,ipAddress:e.new.ip_address})}).subscribe(t=>{"SUBSCRIBED"===t?console.log("✅ Conectado ao realtime de lances: ".concat(e)):"CHANNEL_ERROR"===t&&console.error("❌ Erro ao conectar no canal de lances: ".concat(e))});return this.channels.set(s,a),a}subscribeToAuctionStatus(e,t){let s="auction-status-".concat(e);if(this.channels.has(s))return this.channels.get(s);let a=o.N.channel(s).on("postgres_changes",{event:"UPDATE",schema:"public",table:"auctions",filter:"id=eq.".concat(e)},e=>{let s=e.new.status;console.log("Status do leil\xe3o alterado:",s),t(s)}).subscribe(t=>{"SUBSCRIBED"===t&&console.log("✅ Conectado ao realtime de status: ".concat(e))});return this.channels.set(s,a),a}unsubscribe(e){let t=this.channels.get(e);t&&(o.N.removeChannel(t),this.channels.delete(e),console.log("\uD83D\uDD0C Desconectado do canal: ".concat(e)))}unsubscribeAll(){this.channels.forEach((e,t)=>{o.N.removeChannel(e),console.log("\uD83D\uDD0C Desconectado do canal: ".concat(t))}),this.channels.clear()}getChannelStatus(e){let t=this.channels.get(e);return(null==t?void 0:t.state)||null}constructor(){this.channels=new Map}}let u=new d;var m=s(5132),h=s(211);let x=e=>{let{currentBid:t,minIncrement:s,onPlaceBid:n,disabled:l}=e,[i,c]=(0,r.useState)(""),o=t+s,d=[o,o+s,o+2*s,o+4*s];return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("div",{className:"grid grid-cols-2 gap-2",children:d.map(e=>(0,a.jsx)(m.$,{variant:"outline",className:"h-12 text-sm md:text-base border-primary/20 hover:bg-primary/5 hover:border-primary text-primary",onClick:()=>n(e),disabled:l,children:(0,h.vv)(e)},e))}),(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault();let t=parseFloat(i);!isNaN(t)&&t>=o&&(n(t),c(""))},className:"flex gap-2",children:[(0,a.jsxs)("div",{className:"relative flex-1",children:[(0,a.jsx)("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-500",children:"R$"}),(0,a.jsx)("input",{type:"number",className:"w-full h-12 rounded-lg border border-slate-300 dark:border-slate-700 pl-10 pr-4 bg-white dark:bg-slate-900 text-slate-900 dark:text-white focus:ring-2 focus:ring-primary/50 outline-none",placeholder:o.toString(),min:o,step:s,value:i,onChange:e=>c(e.target.value),disabled:l})]}),(0,a.jsx)(m.$,{type:"submit",disabled:l||!i,className:"h-12 px-6",children:"Dar Lance"})]})]})};var b=s(1433);let p=e=>{let{status:t,connectionStatus:s}=e;return(0,a.jsxs)("div",{className:"flex items-center gap-2 bg-black/80 backdrop-blur-sm px-3 py-1.5 rounded-full text-white text-xs font-medium",children:[(0,a.jsx)("div",{className:(0,b.cn)("w-2 h-2 rounded-full animate-pulse","LIVE"===t?"bg-red-500":"bg-slate-400")}),(0,a.jsx)("span",{children:"LIVE"===t?"AO VIVO":t}),"CONNECTED"!==s&&(0,a.jsx)("span",{className:"text-red-400 ml-2",children:"(Offline)"})]})},f=(0,s(1847).A)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),g=e=>{let{state:t,connectionStatus:s,onPlaceBid:r}=e;return(0,a.jsxs)("div",{className:"bg-white dark:bg-[#111722] rounded-xl border-2 border-primary/20 p-6 relative overflow-hidden",children:[(0,a.jsx)("div",{className:"absolute top-0 right-0 p-32 bg-primary/5 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2 pointer-events-none"}),(0,a.jsxs)("div",{className:"flex justify-between items-start mb-6 relative",children:[(0,a.jsx)(p,{status:t.status,connectionStatus:s}),(0,a.jsxs)("div",{className:"flex items-center gap-1.5 text-red-500 font-mono font-medium bg-red-50 dark:bg-red-900/20 px-3 py-1 rounded-lg",children:[(0,a.jsx)(f,{size:16}),(0,a.jsx)("span",{children:"00:15:30"})]})]}),(0,a.jsxs)("div",{className:"text-center mb-8 relative",children:[(0,a.jsx)("p",{className:"text-slate-500 dark:text-slate-400 text-sm mb-1",children:"Lance Atual"}),(0,a.jsx)("div",{className:"text-5xl font-bold text-slate-900 dark:text-white mb-2 animate-in zoom-in duration-300",children:(0,h.vv)(t.currentBid)}),t.lastBidderName&&(0,a.jsxs)("p",{className:"text-sm font-medium text-emerald-600 dark:text-emerald-400 bg-emerald-50 dark:bg-emerald-900/10 inline-block px-3 py-1 rounded-full",children:["Vencendo: ",t.lastBidderName]})]}),(0,a.jsx)("div",{className:"relative",children:(0,a.jsx)(x,{currentBid:t.currentBid,minIncrement:t.nextMinimumBid-t.currentBid,onPlaceBid:r,disabled:"LIVE"!==t.status||"CONNECTED"!==s})})]})},v=e=>{let{bids:t}=e;return(0,a.jsxs)("div",{className:"flex flex-col h-full bg-white dark:bg-[#111722] rounded-xl border border-slate-200 dark:border-slate-800 overflow-hidden",children:[(0,a.jsx)("div",{className:"p-4 border-b border-slate-200 dark:border-slate-800 bg-slate-50 dark:bg-slate-800/50",children:(0,a.jsx)("h3",{className:"font-semibold text-slate-900 dark:text-white",children:"Hist\xf3rico de Lances"})}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-3 max-h-[400px]",children:[t.map((e,t)=>(0,a.jsxs)("div",{className:"flex justify-between items-center text-sm animate-in slide-in-from-left duration-300",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-slate-400 font-mono text-xs",children:new Date(e.timestamp).toLocaleTimeString()}),(0,a.jsxs)("span",{className:"font-medium text-slate-700 dark:text-slate-200",children:[e.userName,0===t&&(0,a.jsx)("span",{className:"ml-2 text-[10px] bg-primary/10 text-primary px-1.5 py-0.5 rounded",children:"Atual"})]})]}),(0,a.jsx)("span",{className:"font-bold text-slate-900 dark:text-white",children:(0,h.vv)(e.amount)})]},e.id)),0===t.length&&(0,a.jsx)("p",{className:"text-center text-slate-400 py-8",children:"Nenhum lance ainda."})]})]})};var N=s(8010),j=s(2292),y=s(9129),w=s(4197),E=s(5626),k=s(63);function C(e){var t;let{params:s}=e,o=(0,k.useRouter)(),{id:d}=(0,r.use)(s),{state:h,connectionStatus:x,placeBid:b}=function(e){let{bidRepo:t}=(0,l.u)(),{user:s}=(0,i.A)(),[a,n]=(0,r.useState)(null),[o,d]=(0,r.useState)("CONNECTING"),[u,m]=(0,r.useState)(!1),[h,x]=(0,r.useState)(null),b=(0,r.useCallback)(async()=>{try{x(null);let t=await fetch("/api/bids/".concat(e));if(!t.ok)throw Error("Erro ao buscar lances");let s=await t.json();if(s.success&&s.data){let{bids:t}=s.data,a=t.length>0?t[0].amount:0,r={auctionId:e,currentBid:a,nextMinimumBid:a+100,lastBidderId:t.length>0?t[0].userId:null,lastBidderName:t.length>0?"User ".concat(t[0].userId.slice(0,4)):null,bids:t.map(e=>({...e,userName:"User ".concat(e.userId.slice(0,4))}))};n(r),d("CONNECTED")}}catch(e){console.error("Error fetching bids:",e),x("Erro ao carregar lances"),d("DISCONNECTED")}},[e]);(0,r.useEffect)(()=>{e&&b()},[e,b]),(0,r.useEffect)(()=>{let s=t.subscribeToAuctionBids(e,e=>{n(t=>t?t.bids.some(t=>t.id===e.id)?t:{...t,currentBid:e.amount>t.currentBid?e.amount:t.currentBid,nextMinimumBid:(e.amount>t.currentBid?e.amount:t.currentBid)+100,lastBidderId:e.userId,lastBidderName:"User ".concat(e.userId.slice(0,4)),bids:[{...e,userName:"User ".concat(e.userId.slice(0,4))},...t.bids]}:null)});return()=>{s()}},[e,t]);let p=(0,r.useCallback)(async t=>{try{if(m(!0),x(null),!s)return void c.o.error("Voc\xea precisa estar logado para dar lances");if(!a)return void c.o.error("Aguarde o carregamento dos dados do leil\xe3o");if(t<a.nextMinimumBid)return void c.o.error("O lance m\xednimo \xe9 R$ ".concat(a.nextMinimumBid.toFixed(2)));let r=await fetch("/api/bids",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({auctionId:e,amount:t})}),n=await r.json();if(!r.ok||!n.success)throw Error(n.error||"Erro ao processar lance");c.o.success("Lance realizado com sucesso!"),await b()}catch(t){console.error("Failed to place bid:",t);let e=t instanceof Error?t.message:"Erro ao dar lance";x(e),c.o.error(e)}finally{m(!1)}},[e,s,a,b]);return{state:a,connectionStatus:o,placeBid:p,isPlacingBid:u,error:h,refetch:b}}(d),{bids:p,isConnected:f}=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],[s,a]=(0,r.useState)(t),[n,l]=(0,r.useState)(!1),i=s.length>0?s[0]:null;return(0,r.useEffect)(()=>{if(!e)return;u.subscribeToAuctionBids(e,e=>{a(t=>{if(t.some(t=>t.id===e.id))return t;let s=[e,...t];try{let e=new Audio("/sounds/bid-notification.mp3");e.volume=.3,e.play().catch(()=>{})}catch(e){}return s})});let t=setInterval(()=>{l("joined"===u.getChannelStatus("auction-bids-".concat(e)))},1e3);return()=>{clearInterval(t),u.unsubscribe("auction-bids-".concat(e)),l(!1)}},[e]),{bids:s,latestBid:i,isConnected:n,setBids:a}}(d,(null==h?void 0:h.bids)||[]),{status:C,isActive:S,isConnected:I}=function(e,t){let[s,a]=(0,r.useState)(t),[n,l]=(0,r.useState)(!1);(0,r.useEffect)(()=>{if(!e)return;u.subscribeToAuctionStatus(e,e=>{console.log("Status alterado: ".concat(s," → ").concat(e)),a(e)});let t=setInterval(()=>{l("joined"===u.getChannelStatus("auction-status-".concat(e)))},1e3);return()=>{clearInterval(t),u.unsubscribe("auction-status-".concat(e)),l(!1)}},[e,s]);let i="ACTIVE"===s,c="PAUSED"===s,o="FINISHED"===s;return{status:s,isActive:i,isPaused:c,isFinished:o,isConnected:n}}(d,"ACTIVE"),{currentVehicle:B,getVehicle:A}=(0,y.T)();return(r.useEffect(()=>{A("mock-vehicle-id")},[A]),h)?(0,a.jsxs)("div",{className:"min-h-screen bg-slate-50 dark:bg-[#0d121c]",children:[(0,a.jsx)("header",{className:"bg-white dark:bg-[#111722] border-b border-slate-200 dark:border-slate-800 p-4 sticky top-0 z-30",children:(0,a.jsxs)(n.m,{className:"py-0 flex items-center justify-between",children:[(0,a.jsxs)(m.$,{variant:"ghost",onClick:()=>o.back(),children:[(0,a.jsx)(E.A,{size:20,className:"mr-2"}),"Sair do Leil\xe3o"]}),(0,a.jsx)("div",{className:"bg-red-600 text-white px-3 py-1 rounded text-xs font-bold animate-pulse",children:"AO VIVO"})]})}),(0,a.jsx)(n.m,{fluid:!0,className:"max-w-[1600px]",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-6 pb-20",children:[(0,a.jsx)("div",{className:"lg:col-span-8 space-y-6",children:(0,a.jsxs)("div",{className:"bg-black aspect-video rounded-xl overflow-hidden relative group",children:[(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center text-white/50",children:(0,a.jsx)("p",{children:"Transmiss\xe3o de V\xeddeo Simulada"})}),(null==B||null==(t=B.images)?void 0:t[0])&&(0,a.jsx)("img",{src:B.images[0].url,className:"w-full h-full object-cover opacity-50",alt:"Live feed background"})]})}),(0,a.jsxs)("div",{className:"lg:col-span-4 flex flex-col gap-4 h-[calc(100vh-140px)] sticky top-24",children:[(0,a.jsx)(g,{state:h,connectionStatus:x,onPlaceBid:b}),(0,a.jsx)(v,{bids:h.bids})]}),(0,a.jsxs)("div",{className:"lg:col-span-8 space-y-6",children:[B&&(0,a.jsx)(N.Z,{vehicle:B}),B&&(0,a.jsx)(j.f,{vehicle:B})]})]})})]}):(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-slate-50 dark:bg-[#0d121c]",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(w.y,{size:"lg",className:"mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-slate-500",children:"Conectando ao leil\xe3o ao vivo..."})]})})}}},e=>{e.O(0,[779,417,720,334,969,441,255,358],()=>e(e.s=191)),_N_E=e.O()}]);