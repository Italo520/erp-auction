"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[334],{334:(e,t,a)=>{a.d(t,{m:()=>D,u:()=>I});var i=a(5155),n=a(2115),s=a(1136);class o{async signIn(e,t){if(t){let{error:a}=await s.N.auth.signInWithPassword({email:e,password:t});if(a)throw a}else{let{error:t}=await s.N.auth.signInWithOtp({email:e});if(t)throw t}}async verifyOtp(e,t){let{data:a,error:i}=await s.N.auth.verifyOtp({email:e,token:t,type:"email"});if(i)throw i;let n=null;if(a.user){var o,r,l,c;n={id:a.user.id,email:a.user.email,name:(null==(o=a.user.user_metadata)?void 0:o.name)||"User",role:(null==(r=a.user.user_metadata)?void 0:r.role)||"BIDDER",isActive:null==(c=null==(l=a.user.user_metadata)?void 0:l.isActive)||c,createdAt:new Date(a.user.created_at),updatedAt:new Date(a.user.updated_at||a.user.created_at)}}return{user:n,session:a.session}}async signOut(){let{error:e}=await s.N.auth.signOut();if(e)throw e}async getCurrentUser(){var e,t,a,i;let{data:{user:n}}=await s.N.auth.getUser();return n?{id:n.id,email:n.email,name:(null==(e=n.user_metadata)?void 0:e.name)||"User",role:(null==(t=n.user_metadata)?void 0:t.role)||"BIDDER",isActive:null==(i=null==(a=n.user_metadata)?void 0:a.isActive)||i,createdAt:new Date(n.created_at),updatedAt:new Date(n.updated_at||n.created_at)}:null}async getSession(){let{data:{session:e}}=await s.N.auth.getSession();return e}}class r{async create(e){let t={name:e.name,start_date_time:e.startDateTime,end_date_time:e.endDateTime,status:e.status,description:e.description,terms_conditions:e.termsConditions},{data:a,error:i}=await s.N.from("auctions").insert(t).select().single();if(i)throw i;return this.mapToDomain(a)}async findById(e){let{data:t,error:a}=await s.N.from("auctions").select("\n            *,\n            auction_items (\n                *,\n                vehicle:vehicles (*)\n            )\n        ").eq("id",e).single();return a?null:this.mapToDomain(t)}async findAll(e){let t=s.N.from("auctions").select("*",{count:"exact"});e.status&&(t=t.eq("status",e.status)),e.search&&(t=t.ilike("name","%".concat(e.search,"%"))),e.dateRange&&(t=t.gte("start_date_time",e.dateRange.start.toISOString()).lte("start_date_time",e.dateRange.end.toISOString()));let a=(e.page-1)*e.limit,i=a+e.limit-1,{data:n,error:o,count:r}=await t.range(a,i);if(o)throw o;return{data:n.map(this.mapToDomain),total:r||0,page:e.page,limit:e.limit,totalPages:Math.ceil((r||0)/e.limit)}}async update(e,t){let a={};t.name&&(a.name=t.name),t.status&&(a.status=t.status),t.startDateTime&&(a.start_date_time=t.startDateTime),t.endDateTime&&(a.end_date_time=t.endDateTime);let{data:i,error:n}=await s.N.from("auctions").update(a).eq("id",e).select().single();if(n)throw n;return this.mapToDomain(i)}async delete(e){let{error:t}=await s.N.from("auctions").delete().eq("id",e);if(t)throw t}async findActiveAuctions(){let e=new Date().toISOString(),{data:t,error:a}=await s.N.from("auctions").select("*").eq("status","ACTIVE").lte("start_date_time",e).gte("end_date_time",e);if(a)throw a;return t.map(this.mapToDomain)}mapToDomain(e){return{id:e.id,name:e.name,startDateTime:new Date(e.start_date_time),endDateTime:new Date(e.end_date_time),status:e.status,description:e.description,termsConditions:e.terms_conditions,items:e.auction_items?e.auction_items.map(e=>({id:e.id,auctionId:e.auction_id,vehicleId:e.vehicle_id,vehicle:e.vehicle,lotNumber:e.lot_number,currentBid:e.current_bid,status:e.status})):[],createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at)}}}class l{async create(e){e.images&&e.images.length;let t={make:e.make,model:e.model,version:e.version,year_manufacture:e.yearManufacture,year_model:e.yearModel,mileage:e.mileage,fuel:e.fuel,transmission:e.transmission,color:e.color,doors:e.doors,plate_end:e.plateEnd,chassis_number:e.chassisNumber,renavam:e.renavam,description:e.description,status:e.status,initial_bid:e.initialBid,minimum_increment:e.minimumIncrement,location_city:e.locationCity,location_state:e.locationState},{data:a,error:i}=await s.N.from("vehicles").insert(t).select().single();if(i)throw i;return this.mapToDomain(a)}async findById(e){let{data:t,error:a}=await s.N.from("vehicles").select("*, vehicle_images(*)").eq("id",e).single();return a?null:this.mapToDomain(t)}async findAll(e){let t=s.N.from("vehicles").select("*, vehicle_images(*)",{count:"exact"});e.status&&(t=t.eq("status",e.status)),e.make&&(t=t.ilike("make","%".concat(e.make,"%"))),e.model&&(t=t.ilike("model","%".concat(e.model,"%"))),e.search&&(t=t.or("make.ilike.%".concat(e.search,"%,model.ilike.%").concat(e.search,"%")));let a=(e.page-1)*e.limit,i=a+e.limit-1,{data:n,error:o,count:r}=await t.range(a,i);if(o)throw o;return{data:n.map(this.mapToDomain),total:r||0,page:e.page,limit:e.limit,totalPages:Math.ceil((r||0)/e.limit)}}async update(e,t){let a={};t.make&&(a.make=t.make),t.model&&(a.model=t.model),t.status&&(a.status=t.status);let{data:i,error:n}=await s.N.from("vehicles").update(a).eq("id",e).select().single();if(n)throw n;return this.mapToDomain(i)}async delete(e){let{error:t}=await s.N.from("vehicles").delete().eq("id",e);if(t)throw t}async addImages(e,t){let a=t.map(t=>({vehicle_id:e,url:t,is_cover:!1})),{error:i}=await s.N.from("vehicle_images").insert(a);if(i)throw i}async setCoverImage(e,t){await s.N.from("vehicle_images").update({is_cover:!1}).eq("vehicle_id",e);let{error:a}=await s.N.from("vehicle_images").update({is_cover:!0}).eq("id",t);if(a)throw a}mapToDomain(e){return{id:e.id,make:e.make,model:e.model,version:e.version,yearManufacture:e.year_manufacture,yearModel:e.year_model,mileage:e.mileage,fuel:e.fuel,transmission:e.transmission,color:e.color,doors:e.doors,plateEnd:e.plate_end,chassisNumber:e.chassis_number,renavam:e.renavam,description:e.description,status:e.status,initialBid:e.initial_bid,minimumIncrement:e.minimum_increment,locationCity:e.location_city,locationState:e.location_state,images:e.vehicle_images?e.vehicle_images.map(e=>({id:e.id,url:e.url,isCover:e.is_cover})):[],createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at)}}async findAvailableVehicles(){let{data:e,error:t}=await s.N.from("vehicles").select("\n                *,\n                vehicle_images (\n                    id,\n                    url,\n                    is_cover,\n                    order\n                )\n            ").is("auction_id",null).order("created_at",{ascending:!1});if(t)throw Error("Erro ao buscar ve\xedculos dispon\xedveis: ".concat(t.message));return(e||[]).map(e=>({id:e.id,auctionId:e.auction_id,lotNumber:e.lot_number,make:e.make,model:e.model,version:e.version,yearManufacture:e.year_manufacture,yearModel:e.year_model,color:e.color,fuel:e.fuel,transmission:e.transmission,mileage:e.mileage,doors:e.doors,engineNumber:e.engine_number,chassisNumber:e.chassis_number,renavam:e.renavam,plateEnd:e.plate_end,status:e.status,initialBid:e.initial_bid,minimumIncrement:e.minimum_increment,currentBid:e.current_bid,description:e.description,locationCity:e.location_city,locationState:e.location_state,images:e.vehicle_images?e.vehicle_images.map(e=>({id:e.id,url:e.url,isCover:e.is_cover,order:e.order})):[],createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at)}))}}class c{async create(e){let t={auction_id:e.auctionId,vehicle_id:e.vehicleId,user_id:e.userId,amount:e.amount,channel:e.channel||"WEB",is_cancelled:e.isCancelled||!1},{data:a,error:i}=await s.N.from("bids").insert(t).select().single();if(i)throw i;return this.mapToDomain(a)}async findByVehicleId(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,{data:a,error:i}=await s.N.from("bids").select("*").eq("vehicle_id",e).order("created_at",{ascending:!1}).limit(t);if(i)throw i;return a.map(this.mapToDomain)}async findHighestBid(e){let{data:t,error:a}=await s.N.from("bids").select("*").eq("vehicle_id",e).order("amount",{ascending:!1}).limit(1).single();if(a&&"PGRST116"!==a.code)throw a;return t?this.mapToDomain(t):null}async findByUserId(e){let{data:t,error:a}=await s.N.from("bids").select("*").eq("user_id",e).order("created_at",{ascending:!1});if(a)throw a;return t.map(this.mapToDomain)}subscribeToVehicleBids(e,t){let a=s.N.channel("vehicle_bids_".concat(e)).on("postgres_changes",{event:"INSERT",schema:"public",table:"bids",filter:"vehicle_id=eq.".concat(e)},e=>{t(this.mapToDomain(e.new))}).subscribe();return()=>{s.N.removeChannel(a)}}subscribeToAuctionBids(e,t){let a=s.N.channel("auction_room:".concat(e)).on("postgres_changes",{event:"INSERT",schema:"public",table:"bids",filter:"auction_id=eq.".concat(e)},e=>{t(this.mapToDomain(e.new))}).subscribe();return()=>{s.N.removeChannel(a)}}mapToDomain(e){return{id:e.id,auctionId:e.auction_id,vehicleId:e.vehicle_id,userId:e.user_id,amount:e.amount,timestamp:new Date(e.created_at),channel:e.channel,ipAddress:e.ip_address,isCancelled:e.is_cancelled}}}let d={id:"user-123",name:"Admin User",email:"admin@leiloes083.com",role:"ADMIN",avatarUrl:"https://lh3.googleusercontent.com/aida-public/AB6AXuAVK4IJfncfhL_25Eq0T7DWIWBhcRywdPro73gr3cybjfflGzyEVZtICR2w8aLUlqGZpqsFz3Xbt-7LhmLGXMQx6LBW2pixE3l6tgPlz8dGr8hEhKKYVdvfw70kSO6_oeynpOZmy34yy1-cjJxbpx0f0QaE5ou8utQ8qxDkedyn5juhAkFpzf_NoJ54gevbAId7-al_sgxEuR3MGkv9twQ080Hc5ZBuZ-tpmdeBqz6O_de4Uim36cmmOStXfUiOkWvMNye1dH0LJjlc",isActive:!0,createdAt:new Date,updatedAt:new Date};class u{async signIn(e,t){console.log("[MockAuth] SignIn requested for ".concat(e," with pass ").concat(t?"***":"OTP")),await new Promise(e=>setTimeout(e,500)),localStorage.setItem("auth_token","mock-jwt-token"),localStorage.setItem("user_data",JSON.stringify(d))}async verifyOtp(e,t){return console.log("[MockAuth] Verify OTP: ".concat(t," for ").concat(e)),await new Promise(e=>setTimeout(e,500)),{user:d,session:{access_token:"mock-jwt-token"}}}async signOut(){console.log("[MockAuth] SignOut"),localStorage.removeItem("auth_token"),localStorage.removeItem("user_data")}async getCurrentUser(){{let e=localStorage.getItem("user_data");if(e)return JSON.parse(e)}return null}async getSession(){{let e=localStorage.getItem("auth_token");return e?{access_token:e}:null}}}var m=a(8577);class h{async create(e){let t={...e,id:"auction-".concat(Math.random().toString(36).substr(2,9)),createdAt:new Date,updatedAt:new Date};return this.auctions.push(t),t}async findById(e){return this.auctions.find(t=>t.id===e)||null}async findAll(e){let t=this.auctions;e.status&&(t=t.filter(t=>t.status===e.status)),e.search&&(t=t.filter(t=>t.name.toLowerCase().includes(e.search.toLowerCase())));let a=(e.page-1)*e.limit;return{data:t.slice(a,a+e.limit),total:t.length,page:e.page,limit:e.limit,totalPages:Math.ceil(t.length/e.limit)}}async update(e,t){let a=this.auctions.findIndex(t=>t.id===e);if(-1===a)throw Error("Auction not found");return this.auctions[a]={...this.auctions[a],...t,updatedAt:new Date},this.auctions[a]}async delete(e){this.auctions=this.auctions.filter(t=>t.id!==e)}async findActiveAuctions(){return this.auctions.filter(e=>e.status===m.Y.ACTIVE)}constructor(){this.auctions=[{id:"auction-124",name:"Leil\xe3o de Ve\xedculos Recuperados #124",description:"Grande oportunidade de ve\xedculos recuperados de financiamento.",status:m.Y.ACTIVE,startDateTime:new Date,endDateTime:new Date(Date.now()+864e5),termsConditions:"Termos padr\xe3o...",location:"S\xe3o Paulo - SP",itemsCount:15,totalEstimatedValue:45e4,createdAt:new Date,updatedAt:new Date},{id:"auction-125",name:"Leil\xe3o de Luxo e Esportivos",description:"Ve\xedculos de alta gama com baixa quilometragem.",status:m.Y.SCHEDULED,startDateTime:new Date(Date.now()+1728e5),endDateTime:new Date(Date.now()+2592e5),termsConditions:"Termos especiais para luxo...",location:"Online",itemsCount:8,totalEstimatedValue:12e5,createdAt:new Date,updatedAt:new Date}]}}let g=[{id:"2045",auctionId:"auction-124",lotNumber:"124",make:"Toyota",model:"Corolla",version:"XEi 2.0 Flex",yearManufacture:2020,yearModel:2021,color:"Prata",fuel:"FLEX",transmission:"AUTOMATIC",mileage:45320,chassisNumber:"9BRBD48...",status:"PUBLISHED",initialBid:7e4,currentBid:85500,minimumIncrement:500,images:[{id:"1",url:"https://lh3.googleusercontent.com/aida-public/AB6AXuCWkFtyzRtIKJMWHnpjM84ViDteXM25ystnFBAND8HI-jljLRlNO7EGPo_rJmJmcYbIDQ41N07DMh7IiWooSEhYTM2PzVsNJIgrGh5P9yX6JjbsUtOTH5U_5lhFzoMY4HVkWpMsIUrDmhKgDKSpvtL4Gr4H117y7t7yNkaSfLJvqBZfhBiP0KgiFhi7YSVh84dZyKAs98j0lG6ijNSfRCFWMcHg6WjhqeSuL09VJBf7e5Ab6953-IdewS_oIqmK-Lx0KvkO35BK41Pm",isCover:!0,order:1}],locationCity:"Jo\xe3o Pessoa",locationState:"PB",createdAt:new Date,updatedAt:new Date},{id:"2046",auctionId:"auction-124",lotNumber:"125",make:"Honda",model:"Civic",version:"Touring 1.5 Turbo",yearManufacture:2019,yearModel:2020,color:"Branco",fuel:"GASOLINE",transmission:"AUTOMATIC",mileage:32100,chassisNumber:"93HCV...",status:"PUBLISHED",initialBid:9e4,currentBid:112e3,minimumIncrement:1e3,images:[{id:"1",url:"https://lh3.googleusercontent.com/aida-public/AB6AXuDD1huaiZU3h-mdUm75pgOfyT7gX5-SIvXmZxB_QyB22NirwT3gWgsHWwD1dQ5OyZSYl-6ai8jmVqwWTJXwpFox5r8jfH7o7uEPdmdhFNyHcAFoBe-LI9CTCdQojeEIEZ_ugM-9S-gNga1Y1cWQ0klgX4uw8hB3Nuf4IFE6Sfr-zzWQ8ArtweZrILHrj6RrXjCoaCkmhRnkfY3KfUPQV2oKceGzAzl9_EvLakHW5GXd-_2FGjlHIEk0CEO_tFSCHL9X0iezE93bWKpf",isCover:!0,order:1}],locationCity:"Recife",locationState:"PE",createdAt:new Date,updatedAt:new Date}];class _{async create(e){let t={...e,id:Math.floor(1e4*Math.random()).toString(),images:[],createdAt:new Date,updatedAt:new Date};return g.push(t),t}async findById(e){return g.find(t=>t.id===e)||null}async findAll(e){let t=[...g];if(e.auctionId&&(t=t.filter(t=>t.auctionId===e.auctionId)),e.search){let a=e.search.toLowerCase();t=t.filter(e=>{var t;return e.model.toLowerCase().includes(a)||e.make.toLowerCase().includes(a)||(null==(t=e.lotNumber)?void 0:t.includes(a))})}return{data:t,total:t.length,page:e.page,limit:e.limit,totalPages:Math.ceil(t.length/e.limit)}}async update(e,t){let a=g.findIndex(t=>t.id===e);if(-1===a)throw Error("Vehicle not found");return g[a]={...g[a],...t,updatedAt:new Date},g[a]}async delete(e){let t=g.findIndex(t=>t.id===e);-1!==t&&g.splice(t,1)}async addImages(e,t){let a=g.find(t=>t.id===e);if(a){let e=a.images.length+1,i=t.map((t,i)=>({id:Math.random().toString(),url:t,isCover:0===a.images.length&&0===i,order:e+i}));a.images.push(...i)}}async setCoverImage(e,t){let a=g.find(t=>t.id===e);a&&a.images.forEach(e=>{e.isCover=e.id===t})}}let p=[{id:"bid-1",auctionId:"auction-124",vehicleId:"2045",userId:"user-101",amount:85500,timestamp:new Date(Date.now()-12e4),channel:"WEB",isCancelled:!1},{id:"bid-2",auctionId:"auction-124",vehicleId:"2045",userId:"user-102",amount:85e3,timestamp:new Date(Date.now()-3e5),channel:"APP",isCancelled:!1}];class f{async create(e){let t={...e,id:"bid-".concat(Date.now()),timestamp:new Date};return p.unshift(t),t}async findByVehicleId(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;return p.filter(t=>t.vehicleId===e&&!t.isCancelled).sort((e,t)=>t.amount-e.amount).slice(0,t)}async findHighestBid(e){let t=p.filter(t=>t.vehicleId===e&&!t.isCancelled).sort((e,t)=>t.amount-e.amount);return t.length>0?t[0]:null}async findByUserId(e){return p.filter(t=>t.userId===e)}subscribeToVehicleBids(e,t){console.log("[MockRealtime] Subscribed to bids for vehicle ".concat(e));let a=setInterval(()=>{if(Math.random()>.5){var a;let i=(null==(a=p.filter(t=>t.vehicleId===e).sort((e,t)=>t.amount-e.amount)[0])?void 0:a.amount)||5e4,n={id:"bid-auto-".concat(Date.now()),auctionId:"auction-124",vehicleId:e,userId:"user-random-"+Math.floor(100*Math.random()),amount:i+500,timestamp:new Date,channel:"WEB",isCancelled:!1};p.unshift(n),t(n)}},15e3);return()=>{console.log("[MockRealtime] Unsubscribed from vehicle ".concat(e)),clearInterval(a)}}subscribeToAuctionBids(e,t){console.log("[MockRealtime] Subscribed to bids for auction ".concat(e));let a=setInterval(()=>{if(Math.random()>.5){let a=5e4+Math.floor(1e4*Math.random()),i={id:"bid-auto-".concat(Date.now()),auctionId:e,vehicleId:"vehicle-mock",userId:"user-random-"+Math.floor(100*Math.random()),amount:a,timestamp:new Date,channel:"WEB",isCancelled:!1};p.unshift(i),t(i)}},5e3);return()=>{console.log("[MockRealtime] Unsubscribed from auction ".concat(e)),clearInterval(a)}}}var v=a(5704);let w=(0,n.createContext)({}),D=e=>{let{children:t}=e,a="true"===v.env.NEXT_PUBLIC_USE_MOCK,s=(0,n.useMemo)(()=>a?(console.log("⚠️ Using MOCK Repositories"),{authRepo:new u,auctionRepo:new h,vehicleRepo:new _,bidRepo:new f}):(console.log("✅ Using REAL Repositories (Supabase)"),{authRepo:new o,auctionRepo:new r,vehicleRepo:new l,bidRepo:new c}),[a]);return(0,i.jsx)(w.Provider,{value:s,children:t})},I=()=>(0,n.useContext)(w)},1136:(e,t,a)=>{a.d(t,{N:()=>r});var i=a(5417),n=a(5704);let s=n.env.NEXT_PUBLIC_SUPABASE_URL,o=n.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;if(!s||!o)throw Error("Supabase URL and Key must be defined in environment variables");let r=(0,i.createBrowserClient)(s,o)},8577:(e,t,a)=>{a.d(t,{Y:()=>i});var i=function(e){return e.SCHEDULED="SCHEDULED",e.ACTIVE="ACTIVE",e.PAUSED="PAUSED",e.FINISHED="FINISHED",e.CANCELLED="CANCELLED",e}({})}}]);